%%%%%%%%
% for Sail listing
\usepackage[T1]{fontenc}
\usepackage[scaled=0.82]{beramono}
\usepackage{amssymb}
\usepackage[tikz]{mdframed}

% Set default Sail source parameters as a style,
% to avoid conflicts with other sources.
\lstdefinestyle{saildefault}{
% basicstyle=\ttfamily\small,
  basicstyle=\renewcommand{\baselinestretch}{0.9}\ttfamily\small,
  numbers=left,numberstyle=\tiny,numbersep=5pt,
  columns=fullflexible,
  breaklines=true,
  postbreak=\mbox{\textcolor{red}{$\hookrightarrow$}\space},
}

\lstdefinelanguage{sail}
  {style=saildefault,
   morekeywords={val,function,cast,type,forall,overload,operator,
                 enum,union,undefined,exit,and,assert,sizeof,
                 scattered,register,inc,dec,if,then,else,effect,
                 let,as,@,in,end,Type,Int,Order,match,clause,struct},
   keywordstyle={\bf\ttfamily},
   morestring=[b]'',
   stringstyle={\ttfamily\color{red}},
   % Making comments invisible, (ie. using [i]) seems to trigger a bug in listings.
   % Although it would be nicer to not print Sail comments, for now we just print them.
   morecomment=[l]{//},
   morecomment=[s]{/*}{*/},
   deletestring=[bd]{'},
   escapechar=\#,
   emphstyle={\it},
   literate=
      {\{|}{{$\{|$}}1
      {|\}}{{$|\}$}}1
  }

\newboolean{SAIL}
\setboolean{SAIL}{true}
%\setboolean{SAIL}{false}

\ifthenelse{\boolean{SAIL}}{
  \input{generated_definitions/latex/commands.tex}
  \usepackage[scaled=0.82]{beramono}
  % Define macros used in the Sail-generated latex.
  \newcommand{\saildocfcl}[2]{#1 #2}
  \newcommand{\saildocfn}[2]{#1 #2}
  \newcommand{\saildoctype}[2]{#1 #2}

  % Define other macros that we use manually in the documentation.
  \newcommand{\sailfname}[1]{\texttt{\textit{$#1$}}}
} % else not SAIL.
{
  \newcommand{\saildocfcl}[2]{}
  \newcommand{\saildocfn}[2]{}
  \newcommand{\saildoctype}[2]{}
}

\newenvironment{formalspec}
{ \vspace{-0.2in}
  \begin{quotation}
  \noindent
  \small \em
  \rule{\linewidth}{1pt}\\
}
{
  \rule{\linewidth}{1pt}
  \end{quotation}
  \vspace{-0.2in}
}
% This is intended to be used right after a formalspec.
\newenvironment{formalcomment}
{ \vspace{-0.2in}
  \begin{quotation}
  \begin{mdframed}[linewidth=1.5pt,roundcorner=8pt]
  \noindent \small \em
%  \rule{\linewidth}{1pt}\\
}
{ \hfill \\
%  \rule{\linewidth}{1.5pt}
  \end{mdframed}
  \end{quotation}
  \vspace{-0.2in}
}

% This is intended to be used right after a commentary block, typically in the privileged spec.
\newenvironment{addformalcomment}
{ \vspace{-0.2in}
  \begin{quotation}
  \begin{mdframed}[linewidth=1.5pt,roundcorner=8pt]
  \noindent \small \em
%  \rule{\linewidth}{1.5pt}\\
}
{ \hfill \\
%  \rule{\linewidth}{1pt}
  \end{mdframed}
  \end{quotation}
  \vspace{-0.2in}
}
